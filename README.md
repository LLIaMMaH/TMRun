# TMRun
Tmux Minecrat Run script - Скрипт для запуска серверов minecraft при запуске системы.

Если у вас несколько серверов minecraft (даже если он один), то с помощью данного скрипта можно запустить их сразу все при старте системы.

Первое, что вам понадобится, так это утилита `tmux`.
> **[tmux][tmux]** — свободная консольная утилита-мультиплексор, предоставляющая пользователю доступ к нескольким терминалам в рамках одного экрана. [tmux][tmux] может быть отключен от экрана: в этом случае он продолжит исполняться в фоновом режиме; имеется возможность вновь подключиться к [tmux][tmux], находящемуся в фоне. [tmux][tmux] является штатным мультиплексором терминалов операционной системы [OpenBSD](https://ru.wikipedia.org/wiki/OpenBSD "OpenBSD"). Программа [tmux][tmux] задумывалась как замена программы [GNU Screen](https://ru.wikipedia.org/wiki/GNU_Screen "GNU Screen").

Если данной утилиты у вас ещё не установлено, то от имени супер-пользователя выполните в консоле (терминале) команду:
```bash
# Arch Linux
pacman -S tmux

# Debian/Ubuntu/Linux Mint
apt install tmux

# Fedora
dnf install tmux

# RHEL or CentOS
yum install tmux

# macOS (using Homebrew
brew install tmux

# macOS (using MacPorts)
port install tmux

# openSUSE
zypper install tmux
```

Второе: Для того, чтобы происходил запуск при старте системы нужно добавить конкретному пользователю (от имени которого вы запускаете сервера minecraft) в `crontab` соответствующую запись. *Команду нужно выполнять без привилегий супер-пользователя.* Залогинившись под пользователем, под которым вы запускаете сервер в консоле (терминале) выполните команду:
```bash
crontab -e

# Для нужного пользователя
sudo crontab -u имя_пользователя -e
```
В конце открывшегося файла, добавьте такую строку:
```bash
@reboot /path/tmux_minecraft.sh
<- Тут пустая строка
```
`path` - измените на путь, где лежит у вас скрипт. Например: `/home/mcserver/tmux_minecraft.sh`
> В конце файла должна быть обязательно пустая строка, иначе при сохранении вы получите ошибку.


**Немного о самом скрипте:**
Скрипт создаёт сессию, которой потом отправляет набор команд.
```bash
tmux new -s MCS -d
```
`new -s` - Создать новую сессиию.
`MCS` - Имя сессии, по которому вы потом будете подключаться.
`-d` - Отключиться от данной сессии.

Далее идёт набор команд, по управлению окном и запуском сервера.
```bash
tmux rename-window Bungee_Lobby
tmux send-keys -t MCS:1.1 'cd /data/minecraft/server/mcsettlers/BungeeCord/ && ./start.sh' Enter
tmux split-window -h -t MCS:1.1
tmux send-keys -t MCS:1.2 'cd /data/minecraft/server/mcsettlers/Lobby/ && ./start.sh' Enter
```
Любая сессия имеет одно окно. По умолчанию окна нумеруются с `0`, `1`, `2` и т.д. Но это можно изменить в настройках [tmux][tmux], в файле `~/.tmux.conf`
```bash
set -g base-index 1   # start windows numbering at 1
```
В данном случае у меня настроено, что нумеровать окна с 1 и когда отправляется команда, то я указываю номера окон с `1`.
`send-keys -t MCS:1.1` - Отправить нажатие клавиш в сессию `-t MCS` окно `1.1` и после нажатия клавиши, что указаны в одиночных кавычках `'cd /data/minecraft/server/mcsettlers/BungeeCord/ && ./start.sh'` нажать клавишу `Enter`.
Если у вас всего один сервер, то можно и не переименовывать окно. Я же делаю переименование окон по версиям minecraft.

Далее, при необходимости создаёт новое окно с указанным именем:
```bash
tmux new-window -n 1.16.5
tmux send-keys -t MCS:2.1 'cd /data/minecraft/server/1.16.5/20210815-Vanilla && ./start.sh' Enter
tmux split-window -h -t MCS:2.1
tmux send-keys -t MCS:2.2 'cd /data/minecraft/server/1.16.5/20220501-OtherWorlds && ./start.sh' Enter
```
В итоге, в одной сессии мы можем видеть и управлять всеми серверами minecraft.
Даже если сервера перезагружаются (по расписанию) это всё видно в окне конкретного сервера. У меня задано хранить в оперативной памяти 10.000 строк
```bash
set -g history-limit 10000      # boost history
```
чего всегда хватает и даже слишком. Но это вы уже можете подстроить под себя.

Дополнительно прикладываю свой файл с настройками для [tmux][tmux].

---

**PS:** Для одного сервера скрипт запуска можно сделать гораздо проще:
```bash
# Создаём новую сессию. Переходим в нужную нам папку. Отключаемся от сессии.
tmux new -s MCS -c /server/GTNH274/ -d

tmux send-keys -t MCS:1 './start.sh' Enter
```


[//]: # (Short links)

 [tmux]: <https://tmux.github.io>
